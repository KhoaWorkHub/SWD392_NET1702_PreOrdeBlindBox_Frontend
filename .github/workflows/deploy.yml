name: Deploy to Vercel

on:
  push:
    branches:
      - main  
  pull_request:
    branches:
      - main  

jobs:
  deploy:
    runs-on: ubuntu-latest
    env:
      VERCEL_TOKEN: ${{ secrets.VERCEL_TOKEN }}
      VERCEL_ORG_ID: ${{ secrets.VERCEL_ORG_ID }}
      VERCEL_PROJECT_ID: ${{ secrets.VERCEL_PROJECT_ID }}
      VERCEL_TELEMETRY_DISABLED: 1

    steps:
      - name: üöÄ Checkout Repository
        uses: actions/checkout@v4

      - name: üõ†Ô∏è Setup Bun
        uses: oven-sh/setup-bun@v1
        with:
          bun-version: latest

      - name: üì¶ Install Dependencies
        run: bun install

      - name: üî® Build Project
        run: bun run build

      - name: üì• Deploy to Vercel
        run: |
          npm install -g vercel
          
          # Create deployment script
          cat > deploy.sh << 'EOF'
          # Save deployment output and errors to files
          vercel deploy --force --yes --token=$VERCEL_TOKEN --prod > deployment-url.txt 2> error.txt

          # Check exit code
          code=$?
          if [ $code -eq 0 ]; then
            deploymentUrl=$(cat deployment-url.txt)
            echo "‚úÖ Deployment successful: $deploymentUrl"
          else
            errorMessage=$(cat error.txt)
            echo "‚ùå Deployment failed: $errorMessage"
            exit 1
          fi
          EOF

          # Make script executable and run it
          chmod +x deploy.sh
          ./deploy.sh